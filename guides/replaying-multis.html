<!doctype html>
<html lang="en">

<head>
    <title>SmallRye Mutiny</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="SmallRye Mutiny!">

    <link rel="canonical" href="/guides/replaying-multis.html">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/styles/default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/icon.min.css" integrity="sha512-8Tb+T7SKUFQWOPIQCaLDWWe1K/SY8hvHl7brOH8Nz5z1VT8fnf8B+9neoUzmFY3OzkWMMs3OjrwZALgB1oXFBg==" crossorigin="anonymous" />
    <link rel="shortcut icon" type="image/png" href="/smallrye-mutiny/assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="/smallrye-mutiny/assets/css/main.css" />
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/font-awesome-line-awesome/css/all.min.css">
    <link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css">
</head>

<body>
    <div class="container-fluid global-container">
        





<header class="header masthead mb-auto">
    <div class="container">
        <nav class="navbar navbar-dark navbar-expand-lg">
            <a class="navbar-brand brand mutiny" href="/smallrye-mutiny/index.html"><strong>Mutiny!</strong></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#toggler"
                    aria-controls="toggler" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="toggler">
                <ul class="navbar-nav ml-auto mr-0 mt-2 mt-lg-0">
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/pages/philosophy">Philosophy</a></li>
                    <li class="nav-item"><a class="nav-link " href="/smallrye-mutiny/getting-started/download">Getting started</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/smallrye-mutiny/guides">Guides</a></li>
                    <li class="nav-item"><a class="nav-link" href="https://javadoc.io/doc/io.smallrye.reactive/mutiny/latest/index.html">API</a></li>
                    <li class="nav-item"><a href="https://github.com/smallrye/smallrye-mutiny" target="_blank" title="Github"><i
                            class="lab la-github la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://github.com/smallrye/smallrye-mutiny/discussions" target="_blank" title="Discussions on GitHub"><i
                            class="las la-comments la-2x"></i></a></li>
                    <li class="nav-item"><a href="https://stackoverflow.com/questions/tagged/mutiny" target="_blank"
                                            title="Stack Overflow"><i
                            class="lab la-stack-overflow la-2x"></i></a></li>
                </ul>
            </div>
        </nav>
    </div>
</header>
        <main>
            <div class="content">
                

<section class="hero gs">
    <div class="hero-main container">
        <div class="row">
            <div class="hero-left col-12">
                <div class="hero-slogan">
                    <h1 class="hero-name">Replaying Multis</h1>
                </div>
                <div class="hero-desc">
                    Learn how multiple subscribers can replay from a Multi
                </div>
                <!-- TODO Labels -->
            </div>
        </div>
    </div>
</section>

<div class="container page-content">
    <div class="row">
        <div class="col-md-9 content">
            <div class="paragraph">
<p>A <code>Multi</code> is a <em>cold-source</em>: no processing happens until you subscribe.</p>
</div>
<div class="paragraph">
<p>While the <code>broadcast</code> operator can be used so that multiple subscribers consume a <code>Multi</code> events <em>at the same time</em>, it does not support replaying items for <em>late subscribers</em>: when a subscriber joins after the <code>Multi</code> has completed (or failed), then it won&#8217;t receive any item.</p>
</div>
<div class="paragraph">
<p>This is where <em>replaying</em> can be useful.</p>
</div>
<div class="sect1">
<h2 id="replaying-all-events"><a class="anchor" href="#replaying-all-events"></a>Replaying all events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Replaying all events from an upstream <code>Multi</code> works as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;Integer&gt; upstream = Multi.createFrom().range(0, 10);

Multi&lt;Integer&gt; replay = Multi.createBy().replaying().ofMulti(upstream);

List&lt;Integer&gt; items_1 = replay.collect().asList().await().indefinitely();
List&lt;Integer&gt; items_2 = replay.collect().asList().await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>item_1</code> and <code>item_2</code> trigger new subscriptions, and both lists contain the following elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre>
</div>
</div>
<div class="paragraph">
<p>Replaying works by turning <code>upstream</code> into a <em>hot-stream</em>, meaning that it gets requested <code>Long.MAX_VALUE</code> elements.
This is done when the first subscription happens.</p>
</div>
<div class="paragraph">
<p>The replay operator stores the items in an internal <em>replay log</em>, and then each subscriber gets to replay them.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Subscribers demand and cancellation requests are honored while replaying, but <code>upstream</code> cannot be cancelled.
Be careful with unbounded streams as you can exhaust memory!
In such cases or when you need to replay large amounts of data, you might opt to use some eventing middleware rather than Mutiny replays.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replaying-the-last-n-events"><a class="anchor" href="#replaying-the-last-n-events"></a>Replaying the last 'n' events</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can limit the number of elements to replay by using the <code>upTo</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;Integer&gt; upstream = Multi.createFrom().range(0, 10);

Multi&lt;Integer&gt; replay = Multi.createBy().replaying().upTo(3).ofMulti(upstream);

List&lt;Integer&gt; items_1 = replay.collect().asList().await().indefinitely();
List&lt;Integer&gt; items_2 = replay.collect().asList().await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each new subscriber gets to replay the last <code>n</code> elements from where the replay log is at subscription time.
For instance the first subscriber can observe all events, while a subscriber that joins 2 seconds later might not observe the earlier events.</p>
</div>
<div class="paragraph">
<p>Since <code>Multi.createFrom().range(0, 10)</code> is an <em>immediate</em> stream, both <code>item_1</code> and <code>item_2</code> lists contain the last items:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[7, 8, 9]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prepending-with-seed-data"><a class="anchor" href="#prepending-with-seed-data"></a>Prepending with seed data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases you might want to prepend some <em>seed</em> data that will be available for replay before the upstream starts emitting.</p>
</div>
<div class="paragraph">
<p>You can do so using an <code>Iterable</code> to provide such seed data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;Integer&gt; upstream = Multi.createFrom().range(0, 10);
Iterable&lt;Integer&gt; seed = Arrays.asList(-10, -5, -1);

Multi&lt;Integer&gt; replay = Multi.createBy().replaying().ofSeedAndMulti(seed, upstream);

List&lt;Integer&gt; items_1 = replay.collect().asList().await().indefinitely();
List&lt;Integer&gt; items_2 = replay.collect().asList().await().indefinitely();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In which case subscribers can observe the following events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[-10, -5, -1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replay-of-failures-and-completions"><a class="anchor" href="#replay-of-failures-and-completions"></a>Replay of failures and completions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Subscribers get to observe not just items but also the failure and completion events:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Multi&lt;Integer&gt; upstream = Multi.createBy().concatenating().streams(
        Multi.createFrom().range(0, 10),
        Multi.createFrom().failure(() -&gt; new IOException("boom"))
);

Multi&lt;Integer&gt; replay = Multi.createBy().replaying().upTo(3).ofMulti(upstream);

replay.subscribe().with(
        n -&gt; System.out.println(" -&gt; " + n),
        failure -&gt; System.out.println("Failed: " + failure.getMessage()),
        () -&gt; System.out.println("Completed"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running this code yields the following output for any subscriber:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> -&gt; 7
 -&gt; 8
 -&gt; 9
Failed: boom</pre>
</div>
</div>
</div>
</div>
        </div>
        <div class="col-md-3 col-md-offset-1 toc-container d-sm-none d-md-block">
            <nav class="page-toc toc nav sticky-top" id="toc">
                
                <h4>Table of Content</h4>
                <ul class="sectlevel1">
<li><a href="#replaying-all-events">Replaying all events</a></li>
<li><a href="#replaying-the-last-n-events">Replaying the last 'n' events</a></li>
<li><a href="#prepending-with-seed-data">Prepending with seed data</a></li>
<li><a href="#replay-of-failures-and-completions">Replay of failures and completions</a></li>
</ul>
                

                
            </nav>
        </div>
    </div>
</div>


            </div>
        </main>
        <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-lg-9 sep-right">
                <p>
                    SmallRye Mutiny is an open source project. All the code from this project is available under the <a href="https://raw.githubusercontent.com/smallrye/smallrye-mutiny/main/LICENSE">Apache Software License 2.0</a>.
                </p>
                <p>
                    This website was built with <a href="https://jekyllrb.com/">Jekyll</a>, is hosted on Github Pages and is completely open source.
                    You can <a href="https://github.com/smallrye/smallrye-mutiny">fork it</a> and propose enhancements through pull-requests.
                </p>
                <p>
                    Something's wrong? Open an <a href="https://github.com/smallrye/smallrye-mutiny/issues">issue</a>.
                </p>
            </div>
            <div class="col-lg-3">
                <p>
                    Sponsored by
                    <span class="redhat-logo">
                        <a href="https://www.redhat.com/" target="_blank"><img src="/smallrye-mutiny/assets/images/redhat_reversed.svg"></a>
                    </span>
                </p>
                <p>
                    <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
                    |
                    <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
                </p>
                <p>
                     Site last generated: Jun 20, 2022
                </p>
            </div>
        </div>
    </div>
    <!-- Javascript-->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.1/highlight.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/cferdinandi/gumshoe@4/dist/gumshoe.polyfills.min.js"></script>
    <script src="/smallrye-mutiny/assets/js/hl.js" type="text/javascript"></script>
    <script src="/smallrye-mutiny/assets/js/scrollspy.js" type="text/javascript"></script>

    <script>
        $(document).ready(function(){
            $("#search").on("keyup", function() {
                var value = $(this).val().toLowerCase();
                $(".guide").filter(function() {
                    $(this).toggle($(this).attr("data-search").toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FPQ70JF1EY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-FPQ70JF1EY');
    </script>
</footer>
    </div>
</body>

</html>